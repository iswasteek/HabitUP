<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update User</title>
</head>
<body>
<h2>Update User Profile</h2>

<form id="updateUserForm">
    <label>Email (in URL):</label><br>
    <input type="email" id="email" required><br><br>

    <label>Name:</label><br>
    <input type="text" name="name" required><br><br>

    <label>Date of Birth:</label><br>
    <input type="date" name="dob" required><br><br>

    <label>Phone Number:</label><br>
    <input type="tel" name="phoneNo" required><br><br>

    <label>Gender:</label><br>
    <select name="gender" required>
        <option value="MALE">Male</option>
        <option value="FEMALE">Female</option>
        <option value="OTHER">Other</option>
    </select><br><br>

    <label>Profile Photo:</label><br>
    <input type="file" name="profilePhoto" accept="image/*"><br><br>

    <button type="submit">Update</button>
</form>

<pre id="response"></pre>

<script>
    const form = document.getElementById('updateUserForm');
    const responseBox = document.getElementById('response');

    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.getElementById('email').value;
        const formData = new FormData(form);

        // Get token from localStorage
        const token = localStorage.getItem('token');  // Replace 'token' with your actual key if different

        if (!token) {
            responseBox.textContent = "Error: No token found in localStorage.";
            return;
        }

        try {
            const res = await fetch(`http://localhost:8080/user/updateuser/${encodeURIComponent(email)}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`
                    // Do not manually set Content-Type when sending FormData
                },
                body: formData
            });

            const data = await res.json();

            if (!res.ok) {
                throw new Error(data.message || "Unknown error occurred");
            }

            responseBox.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            responseBox.textContent = 'Error: ' + error.message;
        }
    });
</script>
</body>
</html>

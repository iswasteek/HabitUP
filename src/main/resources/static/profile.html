<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Profile</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="img/HLogo.jpg" rel="icon">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
          integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" rel="stylesheet">

    <!-- Font Awesome -->
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
          integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
          referrerpolicy="no-referrer" rel="stylesheet"/>

    <!-- AOS (Animate On Scroll) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="nav.css" rel="stylesheet">
    <style>
        :root {
  --primary-color: #4154f1;
  --primary-light: #f6f8fe;
  --secondary-color: #717ff5;
  --dark-color: #012970;
  --light-color: #f6f9ff;
  --danger-color: #ff4d6d;
  --success-color: #2ecc71;
  --warning-color: #ffc107;
  --info-color: #17a2b8;
  --text-color: #444444;
  --text-light: #6c757d;
  --border-color: #e9ecef;
  --card-shadow: 0 10px 30px -15px rgba(0, 0, 0, 0.1);
  --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--light-color);
  color: var(--text-color);
  overflow-x: hidden;
}

.profile-page {
  padding-top: 80px;
  min-height: 100vh;
  background: linear-gradient(135deg, var(--primary-light) 0%, rgba(255,255,255,1) 100%);
}

/* Profile Card Container */
.profile-card {
  background: white;
  border-radius: 16px;
  box-shadow: var(--card-shadow);
  overflow: hidden;
  transition: var(--transition);
  border: none;
  transform: translateY(0);
}

.profile-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px -15px rgba(0, 0, 0, 0.15);
}

/* Profile Header */
.profile-header {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  padding: 30px 20px;
  text-align: center;
  color: white;
  position: relative;
  overflow: hidden;
  border-radius: 16px 16px 0 0;
}

.profile-header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
  transform: rotate(30deg);
}

/* Horizontal Layout */
.profile-horizontal {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
  padding: 30px;
}

.profile-image-section {
  flex: 0 0 300px;
  text-align: center;
}

.profile-details-section {
  flex: 1;
  min-width: 300px;
}

/* Profile Image */
.profile-img-container {
  width: 200px;
  height: 200px;
  margin: 0 auto 20px;
  border-radius: 50%;
  overflow: hidden;
  border: 5px solid rgba(255,255,255,0.2);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  position: relative;
  z-index: 1;
  transition: var(--transition);
}

.profile-img-container:hover {
  transform: scale(1.05);
  border-color: rgba(255,255,255,0.4);
}

.profile-img-container img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Details Grid */
.profile-details-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}

.detail-item {
  padding: 20px;
  border-radius: 12px;
  background-color: white;
  box-shadow: 0 2px 15px rgba(0,0,0,0.05);
  transition: var(--transition);
  border: 1px solid var(--border-color);
}

.detail-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  border-color: var(--primary-color);
}

.detail-label {
  font-weight: 600;
  color: var(--dark-color);
  margin-bottom: 8px;
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.detail-value {
  color: var(--text-color);
  font-size: 1.1rem;
  font-weight: 500;
}

/* Buttons */
.btn-edit {
  background-color: var(--primary-color);
  color: white;
  border: none;
  border-radius: 50px;
  padding: 12px 25px;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: var(--transition);
  box-shadow: 0 4px 15px rgba(65, 84, 241, 0.3);
  width: 100%;
}

.btn-edit:hover {
  background-color: var(--dark-color);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(65, 84, 241, 0.4);
}

/* Danger Zone */
.danger-zone {
  border: 2px dashed var(--danger-color);
  border-radius: 16px;
  padding: 25px;
  margin-top: 30px;
  background-color: rgba(255, 77, 109, 0.03);
  transition: var(--transition);
}

.danger-zone:hover {
  background-color: rgba(255, 77, 109, 0.07);
  transform: translateY(-2px);
}

.danger-zone h5 {
  color: var(--danger-color);
  margin-bottom: 15px;
  font-weight: 600;
}

.btn-delete {
  background-color: var(--danger-color);
  color: white;
  border-radius: 50px;
  padding: 12px 25px;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: var(--transition);
  box-shadow: 0 4px 15px rgba(255, 77, 109, 0.3);
  width: 100%;
}

.btn-delete:hover {
  background-color: #ff002b;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(255, 77, 109, 0.4);
}

/* Modal Styles */
.modal-content {
  border-radius: 16px;
  border: none;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
}

.modal-header {
  border-bottom: none;
  padding-bottom: 0;
}

.modal-title {
  font-weight: 600;
  color: var(--dark-color);
}

.modal-footer {
  border-top: none;
  padding-top: 0;
}

/* Form Styles */
.form-control, .form-select {
  border-radius: 8px;
  padding: 12px 15px;
  border: 1px solid var(--border-color);
  transition: var(--transition);
}

.form-control:focus, .form-select:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 0.25rem rgba(65, 84, 241, 0.15);
}

/* Profile Picture Upload */
.profile-pic-upload {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto 30px;
  border-radius: 50%;
  overflow: hidden;
  border: 5px solid var(--border-color);
  transition: var(--transition);
}

.profile-pic-upload:hover {
  border-color: var(--primary-color);
}

.profile-pic-upload img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-pic-upload .upload-btn {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: var(--primary-color);
  color: white;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.profile-pic-upload .upload-btn:hover {
  background: var(--dark-color);
  transform: scale(1.1);
}

.profile-pic-upload input[type="file"] {
  display: none;
}

/* Toast Notification */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1100;
}

.toast {
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  border: none;
  overflow: hidden;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.fade-in {
  animation: fadeIn 0.6s ease-out forwards;
}

.delay-1 { animation-delay: 0.1s; }
.delay-2 { animation-delay: 0.2s; }
.delay-3 { animation-delay: 0.3s; }
.delay-4 { animation-delay: 0.4s; }

/* Responsive Adjustments */
@media (max-width: 992px) {
  .profile-horizontal {
    flex-direction: column;
  }

  .profile-image-section {
    flex: 1;
  }
}

@media (max-width: 768px) {
  .profile-page {
    padding-top: 70px;
  }

  .profile-details-grid {
    grid-template-columns: 1fr;
  }

  .profile-img-container {
    width: 150px;
    height: 150px;
  }

  .profile-horizontal {
    padding: 20px;
  }

  .detail-item {
    padding: 15px;
  }
}

@media (max-width: 576px) {
  .profile-header {
    padding: 25px 15px;
  }

  .profile-img-container {
    width: 120px;
    height: 120px;
  }

  .detail-value {
    font-size: 1rem;
  }
}
    </style>
</head>

<body class="profile-page">
<!-- Header (Keep original nav) -->
<header class="header d-flex align-items-center fixed-top" id="header">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

        <!-- Hamburger-->
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>

        <a class="logo d-flex align-items-center me-auto" href="home.html">
            <h1 class="sitename">HabitUP</h1>
            <span>.</span>
        </a>
        <nav class="navmenu" id="navmenu">
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="service.html">Services</a></li>
                <li><a href="blog.html">Blogs</a></li>
                <li><a href="upcoming.html">Upcoming</a></li>
            </ul>
        </nav>
        <div class="dropdown ms-3">
            <img alt="Profile" aria-expanded="false" class="profile-img dropdown-toggle" data-bs-toggle="dropdown"
                 id="profileDropdown"
                 src="img/user.png"
                 style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; transition: var(--transition);">
            <ul aria-labelledby="profileDropdown" class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item active" href="profile.html"><i class="bi bi-person me-2"></i>Profile</a>
                </li>
                <li><a class="dropdown-item" href="dashboard.html"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" href="#" id="logoutBtn"><i
                        class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
            </ul>
        </div>
    </div>

    <!-- Backdrop for sliding drawer -->
    <div class="mobile-nav-backdrop"></div>
</header>

<!-- Main Content -->
<main id="main">
    <section class="section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="profile-card fade-in" data-aos="fade-up" data-aos-duration="800">
                        <div class="profile-header">
                            <h3 class="fade-in delay-1" id="userName">Loading...</h3>
                            <p class="mb-0 fade-in delay-2" id="userEmail">Loading...</p>
                        </div>

                        <div class="profile-body">
                            <div class="profile-horizontal">
                                <div class="profile-image-section">
                                    <div class="profile-img-container">
                                        <img alt="Profile Photo" id="profilePhotoLarge" src="img/user.png">
                                    </div>

                                    <div class="mt-4 fade-in delay-3">
                                        <button class="btn btn-edit rounded-pill px-4 w-100"
                                                data-bs-target="#editProfileModal"
                                                data-bs-toggle="modal">
                                            <i class="bi bi-pencil-fill me-2"></i>Edit Profile
                                        </button>
                                    </div>

                                    <div class="danger-zone fade-in mt-4" data-aos="fade-up" data-aos-delay="300">
                                        <h5><i class="bi bi-exclamation-triangle-fill me-2"></i>Danger Zone</h5>
                                        <p class="text-muted mb-3 small">These actions are irreversible.</p>
                                        <button class="btn btn-delete rounded-pill px-4 w-100" id="deleteAccountBtn">
                                            <i class="bi bi-trash-fill me-2"></i>Delete Account
                                        </button>
                                    </div>
                                </div>

                                <div class="profile-details-section">
                                    <div class="profile-details-grid">
                                        <div class="detail-item fade-in delay-1">
                                            <div class="detail-label">Full Name</div>
                                            <div class="detail-value" id="detailName">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-2">
                                            <div class="detail-label">Email</div>
                                            <div class="detail-value" id="detailEmail">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-3">
                                            <div class="detail-label">Date of Birth</div>
                                            <div class="detail-value" id="detailDob">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-4">
                                            <div class="detail-label">User Type</div>
                                            <div class="detail-value" id="detailUserType">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-1">
                                            <div class="detail-label">Subscription Type</div>
                                            <div class="detail-value" id="detailSubscription">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-2">
                                            <div class="detail-label">Phone Number</div>
                                            <div class="detail-value" id="detailPhone">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-3">
                                            <div class="detail-label">Gender</div>
                                            <div class="detail-value" id="detailGender">Loading...</div>
                                        </div>

                                        <div class="detail-item fade-in delay-4">
                                            <div class="detail-label">Join Date</div>
                                            <div class="detail-value" id="detailJoinDate">Loading...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Edit Profile Modal -->
<div aria-hidden="true" aria-labelledby="editProfileModalLabel" class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="profile-pic-upload mb-4 text-center">
                        <img alt="Profile Photo" id="profilePhotoEdit" src="img/user.png">
                        <label class="upload-btn" for="profilePhotoInput">
                            <i class="bi bi-camera-fill"></i>
                        </label>
                        <input accept="image/*" id="profilePhotoInput" type="file">
                        <small id="fileSizeWarning" style="color: red; display: none;">Profile picture must be less than
                            2 MB.</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="editName">Full Name</label>
                        <input class="form-control" id="editName" required type="text">
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="editDob">Date of Birth</label>
                        <input class="form-control" id="editDob" required type="date">
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="editPhone">Phone Number</label>
                        <input class="form-control" id="editPhone" required type="tel">
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="editGender">Gender</label>
                        <select class="form-select" id="editGender" required>
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal" type="button">Cancel
                </button>
                <button class="btn btn-primary rounded-pill px-4" id="saveProfileBtn" type="button">Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div aria-hidden="true" aria-labelledby="deleteConfirmModalLabel" class="modal fade" id="deleteConfirmModal"
     tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger" id="deleteConfirmModalLabel">Confirm Account Deletion</h5>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete your account? This action cannot be undone. All your data will be
                    permanently removed.</p>
                <div class="form-check mb-3">
                    <input class="form-check-input" id="confirmDeleteCheck" type="checkbox">
                    <label class="form-check-label" for="confirmDeleteCheck">
                        I understand that this action is irreversible
                    </label>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal" type="button">Cancel
                </button>
                <button class="btn btn-danger rounded-pill px-4" disabled id="confirmDeleteBtn" type="button">Delete My
                    Account
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast-container">
    <div aria-atomic="true" aria-live="assertive" class="toast align-items-center text-white bg-success"
         id="successToast"
         role="alert">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-check-circle-fill me-2"></i>
                <span id="successToastMessage">Profile updated successfully!</span>
            </div>
            <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    type="button"></button>
        </div>
    </div>

    <div aria-atomic="true" aria-live="assertive" class="toast align-items-center text-white bg-danger" id="errorToast"
         role="alert">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span id="errorToastMessage">An error occurred. Please try again.</span>
            </div>
            <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    type="button"></button>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer dark-background" id="footer">
    <div class="container">
        <h3 class="sitename">HabitUP</h3>
        <p>A unit of Sadhana Mandira Charitable Trust || Registered Under Govt. of India</p>
        <div class="social-links d-flex justify-content-center">
            <a href="https://x.com/habitupindia"><i class="bi bi-twitter-x"></i></a>
            <a href="https://www.instagram.com/habitup.india?igsh=amxoMjBhZ3UxMXRt"><i class="bi bi-instagram"></i></a>
            <a href="https://www.linkedin.com/in/habitup-habitup-0a2ab4370?lipi=urn%3Ali%3Apage%3Ad_flagship3_profile_view_base_contact_details%3BSRGPY6S7QbqxKuhCA60kXQ%3D%3D"><i
                    class="bi bi-linkedin"></i></a>
        </div>
        <div class="copyright">
            <span>Copyright</span> <strong class="px-1 sitename">&copy; HabitUP</strong> <span>All Rights
                    Reserved</span>
        </div>
        <div class="credits">
            Designed by <a href="https://www.instagram.com/habitup.india?igsh=amxoMjBhZ3UxMXRt">FullStackFlair</a>
        </div>
    </div>
</footer>

<!-- Scroll Top -->
<a class="scroll-top d-flex align-items-center justify-content-center" href="#" id="scroll-top"><i
        class="bi bi-arrow-up-short"></i></a>

<!-- PreLoader -->
<div id="preloader"></div>

<!-- Vendor JS Files -->
<script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script src="main.js"></script>
<script>
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });
</script>

<!-- Main JS File -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Check if user is authenticated
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'index.html';
        return;
      }

      // Initialize Bootstrap toasts
      const successToast = new bootstrap.Toast(document.getElementById('successToast'));
      const errorToast = new bootstrap.Toast(document.getElementById('errorToast'));

      // Load user data
      loadUserData();

      // Logout button
      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.clear();
        window.location.href = 'index.html';
      });

      // Load profile photo in navbar
      function loadNavProfilePhoto() {
        const profilePhoto = localStorage.getItem('profilePhoto');
        const navProfileImg = document.querySelector('.profile-img');

        if (profilePhoto && profilePhoto.startsWith('data:image')) {
          navProfileImg.src = profilePhoto;
        } else if (profilePhoto) {
          // Convert raw base64 to data URI if needed
          navProfileImg.src = "data:image/jpeg;base64," + profilePhoto;
        } else {
          navProfileImg.src = 'img/user.png';
        }
      }

      // Load user data from localStorage
      function loadUserData() {
        const userData = {
          name: localStorage.getItem('name'),
          email: localStorage.getItem('email'),
          dob: localStorage.getItem('dob'),
          userType: localStorage.getItem('userType'),
          subscriptionType: localStorage.getItem('subscriptionType'),
          phoneNo: localStorage.getItem('phoneNo'),
          gender: localStorage.getItem('gender'),
          joinDate: localStorage.getItem('joinDate'),
          profilePhoto: localStorage.getItem('profilePhoto')
        };

        // Update profile page
        document.getElementById('userName').textContent = userData.name;
        document.getElementById('userEmail').textContent = userData.email;
        document.getElementById('detailName').textContent = userData.name;
        document.getElementById('detailEmail').textContent = userData.email;
        document.getElementById('detailDob').textContent = formatDate(userData.dob);
        document.getElementById('detailUserType').textContent = userData.userType;
        document.getElementById('detailSubscription').textContent = userData.subscriptionType;
        document.getElementById('detailPhone').textContent = userData.phoneNo;
        document.getElementById('detailGender').textContent = userData.gender;
        document.getElementById('detailJoinDate').textContent = formatDate(userData.joinDate);

        // Update profile photos with proper Base64 handling
        updateProfilePhoto(userData.profilePhoto, 'profilePhotoLarge');
        updateProfilePhoto(userData.profilePhoto, 'profilePhotoEdit');

        // Load nav profile photo
        loadNavProfilePhoto();

        // Populate edit form
        document.getElementById('editName').value = userData.name;
        document.getElementById('editDob').value = userData.dob;
        document.getElementById('editPhone').value = userData.phoneNo;
        document.getElementById('editGender').value = userData.gender;
      }

      // Helper function to update profile photos with Base64 handling
      function updateProfilePhoto(photoData, elementId) {
        const imgElement = document.getElementById(elementId);

        if (photoData && photoData.startsWith('data:image')) {
          imgElement.src = photoData;
        } else if (photoData) {
          // Convert raw base64 to data URI
          imgElement.src = "data:image/jpeg;base64," + photoData;
        } else {
          imgElement.src = 'img/user.png';
        }
      }

      // Format date for display
      function formatDate(dateString) {
        if (!dateString) return 'Not specified';
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
      }

      // Handle profile photo upload
      document.getElementById('profilePhotoInput').addEventListener('change', function(e) {
        const file = e.target.files[0];

        // Size validation (2MB max)
        if (file && file.size > 2 * 1024 * 1024) {
          alert('Profile picture must be less than 2 MB.');
          this.value = ""; // Clear the file input
          return;
        }

        // Preview image logic
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            document.getElementById('profilePhotoEdit').src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

// Save profile changes - UPDATED TO MATCH API REQUIREMENTS
      document.getElementById('saveProfileBtn').addEventListener('click', async function() {
        const formData = new FormData();
        const profilePhotoInput = document.getElementById('profilePhotoInput');
        const email = localStorage.getItem('email'); // Get email from localStorage

        // Create userDTO object with only editable fields
        const userDTO = {
          name: document.getElementById('editName').value,
          dob: document.getElementById('editDob').value,
          phoneNo: document.getElementById('editPhone').value,
          gender: document.getElementById('editGender').value
        };

        // Append data to formData as required by API
        formData.append('email', email);
        formData.append('userDTO', JSON.stringify(userDTO)); // Stringify the object

        // Append profile photo if selected
        if (profilePhotoInput.files[0]) {
          formData.append('profilePhoto', profilePhotoInput.files[0]);
        }

        try {
          const response = await fetch('http://localhost:8080/user/updateUser', {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${token}`
              // Don't set Content-Type header - let browser set it with boundary
            },
            body: formData
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to update profile');
          }

          const data = await response.json();

          // Update localStorage with new data
          localStorage.setItem('name', data.name);
          localStorage.setItem('dob', data.dob);
          localStorage.setItem('phoneNo', data.phoneNo);
          localStorage.setItem('gender', data.gender);

          // Handle profile photo Base64 data
          if (data.profilePhoto) {
            let profileImageBase64 = data.profilePhoto;
            if (profileImageBase64 && !profileImageBase64.startsWith("data:image")) {
              profileImageBase64 = "data:image/jpeg;base64," + profileImageBase64;
            }
            localStorage.setItem('profilePhoto', profileImageBase64 || "img/user.png");
          }

          // Reload user data to update UI
          loadUserData();

          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
          modal.hide();

          // Show success toast
          document.getElementById('successToastMessage').textContent = 'Profile updated successfully!';
          successToast.show();

        } catch (error) {
          console.error('Error updating profile:', error);
          document.getElementById('errorToastMessage').textContent = error.message || 'Failed to update profile. Please try again.';
          errorToast.show();
        }
      });

      // Delete account confirmation
      document.getElementById('confirmDeleteCheck').addEventListener('change', function() {
        document.getElementById('confirmDeleteBtn').disabled = !this.checked;
      });

      // Open delete confirmation modal
        document.getElementById('deleteAccountBtn').addEventListener('click', function() {
          const deleteModalEl = document.getElementById('deleteConfirmModal');
          const deleteModal = bootstrap.Modal.getOrCreateInstance(deleteModalEl);
          deleteModal.show();
        });

      // Confirm account deletion
      document.getElementById('confirmDeleteBtn').addEventListener('click', async function() {
        const email = localStorage.getItem('email');
        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`http://localhost:8080/user/${encodeURIComponent(email)}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to delete account');
          }

          // Clear localStorage and redirect
          localStorage.clear();
          window.location.href = 'index.html';

        } catch (error) {
          console.error('Error deleting account:', error);
          document.getElementById('errorToastMessage').textContent = 'Failed to delete account. Please try again.';
          errorToast.show();

          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
          modal.hide();
        }
      });
    });
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Habit Dashboard | HabitUP</title>
    <meta content="Track and manage your habits with HabitUP dashboard" name="description">
    <meta content="habits, tracker, dashboard, productivity, self-improvement" name="keywords">

    <!-- Favicons -->
    <link href="img/HLogo.jpg" rel="icon">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" rel="stylesheet">

    <!-- Font Awesome -->
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" referrerpolicy="no-referrer" rel="stylesheet" />

    <!-- AOS (Animate On Scroll) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Main CSS File -->
    <link href="nav.css" rel="stylesheet">
    <style>
        :root {
          --primary-color: #5f2eea;
          --secondary-color: #fdc134;
          --success-color: #4e9f3d;
          --danger-color: #d62839;
          --light-color: #f8f9fa;
          --dark-color: #1a1a2e;
          --text-color: #333333;
          --text-light: #6c757d;
        }

        body {
          font-family: 'Poppins', sans-serif;
          background-color: #f5f7ff;
          color: var(--text-color);
          padding-top: 80px;
        }

        /* Dashboard Header */
        .dashboard-header {
          background: linear-gradient(135deg, var(--primary-color) 0%, #764ba2 100%);
          color: white;
          padding: 60px 0 40px;
          margin-bottom: 30px;
          position: relative;
          overflow: hidden;
        }

        .dashboard-header::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.1);
        }

        .dashboard-title {
          font-size: 2.5rem;
          font-weight: 700;
          margin-bottom: 10px;
        }

        .dashboard-subtitle {
          font-size: 1.1rem;
          opacity: 0.9;
        }

        /* Stats Cards */
        .stats-card {
          background: white;
          border-radius: 12px;
          padding: 25px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.05);
          margin-bottom: 30px;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
          border-left: 5px solid var(--primary-color);
        }

        .stats-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .stats-card .card-icon {
          font-size: 2.5rem;
          color: var(--primary-color);
          margin-bottom: 15px;
        }

        .stats-card .card-title {
          font-size: 1rem;
          font-weight: 500;
          color: var(--text-light);
          margin-bottom: 5px;
        }

        .stats-card .card-value {
          font-size: 2rem;
          font-weight: 700;
          color: var(--primary-color);
          margin-bottom: 10px;
        }

        .stats-card .card-description {
          font-size: 0.9rem;
          color: var(--text-light);
        }

        /* Habit Cards */
        .habit-card {
          background: white;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 5px 15px rgba(0,0,0,0.05);
          margin-bottom: 30px;
          transition: all 0.3s ease;
          position: relative;
        }

        .habit-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .habit-card-header {
          padding: 20px;
          border-bottom: 1px solid rgba(0,0,0,0.05);
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .habit-card-title {
          font-size: 1.2rem;
          font-weight: 600;
          margin: 0;
          color: var(--primary-color);
        }

        .habit-card-category {
          display: inline-block;
          background: rgba(95, 46, 234, 0.1);
          color: var(--primary-color);
          padding: 3px 10px;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 500;
        }

        .habit-card-body {
          padding: 20px;
        }

        .habit-card-description {
          color: var(--text-light);
          margin-bottom: 20px;
        }

        .habit-progress-container {
          margin-bottom: 20px;
        }

        .habit-progress-label {
          display: flex;
          justify-content: space-between;
          margin-bottom: 5px;
        }

        .habit-progress-bar {
          height: 8px;
          background: #e9ecef;
          border-radius: 4px;
          overflow: hidden;
        }

        .habit-progress-fill {
          height: 100%;
          background: var(--primary-color);
          border-radius: 4px;
          transition: width 0.6s ease;
        }

        .habit-card-footer {
          padding: 15px 20px;
          background: #f8f9fa;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .habit-streak {
          display: flex;
          align-items: center;
          font-weight: 600;
          color: var(--primary-color);
        }

        .habit-streak i {
          margin-right: 5px;
          color: var(--secondary-color);
        }

        /* Calendar Section */
        .calendar-section {
          background: white;
          border-radius: 12px;
          padding: 25px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.05);
          margin-bottom: 30px;
        }

        .calendar-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }

        .calendar-title {
          font-size: 1.3rem;
          font-weight: 600;
          color: var(--primary-color);
          margin: 0;
        }

        .calendar-nav {
          display: flex;
          align-items: center;
        }

        .calendar-nav-btn {
          background: none;
          border: none;
          font-size: 1.2rem;
          color: var(--primary-color);
          cursor: pointer;
          padding: 5px 10px;
        }

        .calendar-month {
          font-weight: 600;
          margin: 0 15px;
        }

        .calendar-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 5px;
        }

        .calendar-day-header {
          text-align: center;
          font-weight: 600;
          font-size: 0.9rem;
          color: var(--text-light);
          padding: 5px;
        }

        .calendar-day {
          aspect-ratio: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.2s;
          position: relative;
        }

        .calendar-day:hover {
          background: rgba(95, 46, 234, 0.1);
        }

        .calendar-day.completed {
          background: rgba(78, 159, 61, 0.2);
          color: var(--success-color);
          font-weight: 600;
        }

        .calendar-day.missed {
          background: rgba(214, 40, 57, 0.1);
          color: var(--danger-color);
        }

        .calendar-day.today {
          border: 2px solid var(--primary-color);
        }

        .calendar-day-notes {
          position: absolute;
          bottom: 2px;
          font-size: 0.6rem;
          color: var(--primary-color);
        }

        /* Charts Section */
        .chart-container {
          background: white;
          border-radius: 12px;
          padding: 25px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.05);
          margin-bottom: 30px;
        }

        .chart-title {
          font-size: 1.3rem;
          font-weight: 600;
          color: var(--primary-color);
          margin-bottom: 20px;
        }

        /* Notes Section */
        .notes-section {
          background: white;
          border-radius: 12px;
          padding: 25px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.05);
          margin-bottom: 30px;
        }

        .notes-title {
          font-size: 1.3rem;
          font-weight: 600;
          color: var(--primary-color);
          margin-bottom: 20px;
        }

        .notes-list {
          max-height: 300px;
          overflow-y: auto;
        }

        .note-item {
          padding: 15px;
          border-bottom: 1px solid rgba(0,0,0,0.05);
          transition: all 0.2s;
        }

        .note-item:hover {
          background: rgba(95, 46, 234, 0.05);
        }

        .note-date {
          font-size: 0.8rem;
          color: var(--text-light);
          margin-bottom: 5px;
        }

        .note-content {
          margin-bottom: 0;
        }

        .add-note-form {
          margin-top: 20px;
        }

        /* Profile Image Styles */
        .profile-img {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          object-fit: cover;
          border: 2px solid rgba(255,255,255,0.2);
          transition: all 0.3s ease;
          cursor: pointer;
        }

        .profile-img:hover {
          transform: scale(1.1);
          border-color: rgba(255,255,255,0.5);
        }

        /* Animation Classes */
        [data-aos="fade-up"] {
          opacity: 0;
          transform: translateY(30px);
          transition-property: transform, opacity;
        }

        [data-aos="fade-up"].aos-animate {
          opacity: 1;
          transform: translateY(0);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
          .dashboard-title {
            font-size: 2rem;
          }

          .stats-card .card-value {
            font-size: 1.8rem;
          }
        }

        /* Custom Animations */
        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }

        .pulse-animation {
          animation: pulse 2s infinite;
        }

        @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-10px); }
          100% { transform: translateY(0px); }
        }

        .float-animation {
          animation: float 6s ease-in-out infinite;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
          width: 8px;
        }

        ::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
          background: var(--primary-color);
          border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: #555;
        }

        /* Modal Styles */
        .modal-content {
          border-radius: 12px;
          border: none;
          box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .modal-header {
          border-bottom: 1px solid rgba(0,0,0,0.05);
          padding: 20px;
        }

        .modal-title {
          color: var(--primary-color);
          font-weight: 600;
        }

        .modal-body {
          padding: 20px;
        }

        .modal-footer {
          border-top: 1px solid rgba(0,0,0,0.05);
          padding: 15px 20px;
        }

        /* Habit Form Styles */
        .form-label {
          font-weight: 500;
          color: var(--text-color);
        }

        .form-control, .form-select {
          border-radius: 8px;
          padding: 10px 15px;
          border: 1px solid rgba(0,0,0,0.1);
        }

        .form-control:focus, .form-select:focus {
          border-color: var(--primary-color);
          box-shadow: 0 0 0 0.25rem rgba(95, 46, 234, 0.25);
        }

        /* Toast Notification */
        .toast-container {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1100;
        }

        .toast {
          border-radius: 8px;
          border: none;
          box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .toast-header {
          border-bottom: none;
          padding: 10px 15px;
          border-radius: 8px 8px 0 0 !important;
        }

        .toast-body {
          padding: 15px;
        }

        /* Empty State */
        .empty-state {
          text-align: center;
          padding: 40px 20px;
        }

        .empty-state-icon {
          font-size: 3rem;
          color: var(--text-light);
          margin-bottom: 20px;
        }

        .empty-state-text {
          color: var(--text-light);
          font-size: 1.1rem;
        }

        /* Streak Counter */
        .streak-counter {
          display: inline-flex;
          align-items: center;
          background: rgba(253, 193, 52, 0.2);
          padding: 5px 10px;
          border-radius: 20px;
          font-weight: 600;
          color: var(--dark-color);
        }

        .streak-counter i {
          margin-right: 5px;
          color: var(--secondary-color);
        }

        /* Frequency Selector */
        .frequency-selector {
          display: flex;
          gap: 5px;
          margin-bottom: 15px;
        }

        .frequency-btn {
          flex: 1;
          border: 1px solid rgba(0,0,0,0.1);
          background: white;
          padding: 8px;
          border-radius: 6px;
          text-align: center;
          cursor: pointer;
          transition: all 0.2s;
        }

        .frequency-btn.active {
          background: var(--primary-color);
          color: white;
          border-color: var(--primary-color);
        }

        /* Color Picker */
        .color-picker {
          display: flex;
          gap: 10px;
          margin-bottom: 15px;
        }

        .color-option {
          width: 30px;
          height: 30px;
          border-radius: 50%;
          cursor: pointer;
          border: 2px solid transparent;
          transition: all 0.2s;
        }

        .color-option.selected {
          transform: scale(1.1);
          border-color: var(--dark-color);
        }

        /* Reminder Toggle */
        .reminder-toggle {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 15px;
        }

        /* Time Picker */
        .time-picker {
          display: flex;
          gap: 10px;
          margin-bottom: 15px;
        }

        .time-picker select {
          flex: 1;
        }
    </style>
</head>

<body class="dashboard-page">
<!-- Header -->
<header class="header d-flex align-items-center fixed-top" id="header">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">
        <a class="logo d-flex align-items-center me-auto" href="index.html">
            <h1 class="sitename">HabitUP</h1>
            <span>.</span>
        </a>
        <nav class="navmenu" id="navmenu">
            <ul>
                <li><a class="active" href="home.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="service.html">Services</a></li>
                <li><a href="blog.html">Blogs</a></li>
                <li><a href="upcoming.html">Upcoming</a></li>
            </ul>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>
        <div class="dropdown ms-3">
            <img src="/static/img/user.png" alt="Profile" class="profile-img dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                <li><a class="dropdown-item" href="profile.html"><i class="bi bi-person me-2"></i>Profile</a></li>
                <li><a class="dropdown-item" href="dashboard.html"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
            </ul>
        </div>
    </div>
</header>

<!-- Main Content -->
<main>
    <!-- Dashboard Header -->
    <section class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="dashboard-title" id="greeting">Your Habit Dashboard</h1>
                    <p class="dashboard-subtitle">Track your progress and stay motivated</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="stats-card float-animation" style="display: inline-block; width: auto;">
                        <div class="card-value" id="total-habits">0</div>
                        <div class="card-title">Active Habits</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="row">
            <!-- Stats Overview -->
            <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
                <div class="stats-card">
                    <div class="card-icon">
                        <i class="bi bi-activity"></i>
                    </div>
                    <div class="card-value" id="current-streak">0</div>
                    <div class="card-title">Current Streak</div>
                    <div class="card-description">Days in a row</div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
                <div class="stats-card">
                    <div class="card-icon">
                        <i class="bi bi-trophy"></i>
                    </div>
                    <div class="card-value" id="longest-streak">0</div>
                    <div class="card-title">Longest Streak</div>
                    <div class="card-description">Your record</div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="300">
                <div class="stats-card">
                    <div class="card-icon">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="card-value" id="completion-rate">0%</div>
                    <div class="card-title">Completion Rate</div>
                    <div class="card-description">This month</div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="400">
                <div class="stats-card">
                    <div class="card-icon">
                        <i class="bi bi-calendar-check"></i>
                    </div>
                    <div class="card-value" id="days-completed">0</div>
                    <div class="card-title">Days Completed</div>
                    <div class="card-description">This month</div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Habits List -->
            <div class="col-lg-8" data-aos="fade-up">
                <div class="habit-card">
                    <div class="habit-card-header">
                        <h3 class="habit-card-title">Your Habits</h3>
                        <button class="btn btn-sm btn-primary" id="add-habit-btn" data-bs-toggle="modal" data-bs-target="#addHabitModal">
                            <i class="bi bi-plus-lg me-1"></i> Add Habit
                        </button>
                    </div>
                    <div class="habit-card-body" id="habits-list">
                        <!-- Habits will be loaded here -->
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="bi bi-emoji-smile"></i>
                            </div>
                            <h5>No habits yet</h5>
                            <p class="empty-state-text">Start by adding your first habit to track your progress</p>
                            <button class="btn btn-primary" id="empty-add-habit-btn" data-bs-toggle="modal" data-bs-target="#addHabitModal">
                                <i class="bi bi-plus-lg me-1"></i> Add Habit
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Section -->
            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="100">
                <div class="calendar-section">
                    <div class="calendar-header">
                        <h3 class="calendar-title">Habit Calendar</h3>
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" id="prev-month"><i class="bi bi-chevron-left"></i></button>
                            <div class="calendar-month" id="current-month">June 2023</div>
                            <button class="calendar-nav-btn" id="next-month"><i class="bi bi-chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendar-days-header">
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                    </div>
                    <div class="calendar-grid" id="calendar-days">
                        <!-- Calendar days will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Progress Charts -->
            <div class="col-lg-6" data-aos="fade-up">
                <div class="chart-container">
                    <h3 class="chart-title">Weekly Progress</h3>
                    <canvas id="weekly-chart"></canvas>
                </div>
            </div>

            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                <div class="chart-container">
                    <h3 class="chart-title">Monthly Consistency</h3>
                    <canvas id="monthly-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Notes Section -->
            <div class="col-lg-12" data-aos="fade-up">
                <div class="notes-section">
                    <h3 class="notes-title">Habit Notes</h3>
                    <div class="notes-list" id="habit-notes">
                        <!-- Notes will be loaded here -->
                        <div class="note-item">
                            <div class="note-date">June 15, 2023</div>
                            <p class="note-content">Felt really motivated today and completed all my habits early in the morning!</p>
                        </div>
                        <div class="note-item">
                            <div class="note-date">June 10, 2023</div>
                            <p class="note-content">Missed my meditation habit because of a late meeting. Will try to do better tomorrow.</p>
                        </div>
                    </div>
                    <div class="add-note-form">
                        <div class="mb-3">
                            <label for="note-date" class="form-label">Date</label>
                            <input type="date" class="form-control" id="note-date">
                        </div>
                        <div class="mb-3">
                            <label for="note-content" class="form-label">Note</label>
                            <textarea class="form-control" id="note-content" rows="3"></textarea>
                        </div>
                        <button class="btn btn-primary" id="save-note-btn">Add Note</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="footer dark-background" id="footer">
    <div class="container">
        <h3 class="sitename">HabitUP</h3>
        <p>Your personalized path to better habits</p>
        <div class="social-links d-flex justify-content-center">
            <a href=""><i class="bi bi-twitter-x"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-skype"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
        </div>
        <div class="copyright">
            <span>Copyright</span> <strong class="px-1 sitename">&copy; HabitUP</strong> <span>All Rights Reserved</span>
        </div>
        <div class="credits">
            Designed by <a href="#">FullStackFlair</a>
        </div>
    </div>
</footer>

<!-- Scroll Top -->
<a class="scroll-top d-flex align-items-center justify-content-center" href="#" id="scroll-top"><i class="bi bi-arrow-up-short"></i></a>

<!-- PreLoader -->
<div id="preloader"></div>

<!-- Add Habit Modal -->
<div class="modal fade" id="addHabitModal" tabindex="-1" aria-labelledby="addHabitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addHabitModalLabel">Add New Habit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="habit-form">
                    <div class="mb-3">
                        <label for="habit-name" class="form-label">Habit Name</label>
                        <input type="text" class="form-control" id="habit-name" placeholder="e.g. Morning Meditation" required>
                    </div>
                    <div class="mb-3">
                        <label for="habit-category" class="form-label">Category</label>
                        <select class="form-select" id="habit-category">
                            <option value="Health">Health</option>
                            <option value="Fitness">Fitness</option>
                            <option value="Productivity">Productivity</option>
                            <option value="Mindfulness">Mindfulness</option>
                            <option value="Learning">Learning</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="habit-description" class="form-label">Description (Optional)</label>
                        <textarea class="form-control" id="habit-description" rows="3" placeholder="Describe your habit..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Frequency</label>
                        <div class="frequency-selector">
                            <button type="button" class="frequency-btn active" data-frequency="daily">Daily</button>
                            <button type="button" class="frequency-btn" data-frequency="weekly">Weekly</button>
                            <button type="button" class="frequency-btn" data-frequency="monthly">Monthly</button>
                        </div>
                        <input type="hidden" id="habit-frequency" value="daily">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Color</label>
                        <div class="color-picker">
                            <div class="color-option selected" style="background-color: #5f2eea;" data-color="#5f2eea"></div>
                            <div class="color-option" style="background-color: #4e9f3d;" data-color="#4e9f3d"></div>
                            <div class="color-option" style="background-color: #fdc134;" data-color="#fdc134"></div>
                            <div class="color-option" style="background-color: #d62839;" data-color="#d62839"></div>
                            <div class="color-option" style="background-color: #1a1a2e;" data-color="#1a1a2e"></div>
                        </div>
                        <input type="hidden" id="habit-color" value="#5f2eea">
                    </div>
                    <div class="mb-3 reminder-toggle">
                        <label class="form-label">Set Reminder</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="habit-reminder">
                        </div>
                    </div>
                    <div class="mb-3 time-picker" id="reminder-time-container" style="display: none;">
                        <select class="form-select" id="reminder-hour">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                        <select class="form-select" id="reminder-minute">
                            <option value="00">00</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="45">45</option>
                        </select>
                        <select class="form-select" id="reminder-period">
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="habit-goal" class="form-label">Goal (Optional)</label>
                        <input type="number" class="form-control" id="habit-goal" placeholder="e.g. 30 days">
                        <div class="form-text">Set a target number of days for this habit</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-habit-btn">Save Habit</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Habit Modal -->
<div class="modal fade" id="editHabitModal" tabindex="-1" aria-labelledby="editHabitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editHabitModalLabel">Edit Habit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="edit-habit-form">
                    <input type="hidden" id="edit-habit-id">
                    <div class="mb-3">
                        <label for="edit-habit-name" class="form-label">Habit Name</label>
                        <input type="text" class="form-control" id="edit-habit-name" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-habit-category" class="form-label">Category</label>
                        <select class="form-select" id="edit-habit-category">
                            <option value="Health">Health</option>
                            <option value="Fitness">Fitness</option>
                            <option value="Productivity">Productivity</option>
                            <option value="Mindfulness">Mindfulness</option>
                            <option value="Learning">Learning</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="edit-habit-description" class="form-label">Description (Optional)</label>
                        <textarea class="form-control" id="edit-habit-description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Frequency</label>
                        <div class="frequency-selector">
                            <button type="button" class="frequency-btn" data-frequency="daily">Daily</button>
                            <button type="button" class="frequency-btn" data-frequency="weekly">Weekly</button>
                            <button type="button" class="frequency-btn" data-frequency="monthly">Monthly</button>
                        </div>
                        <input type="hidden" id="edit-habit-frequency" value="daily">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Color</label>
                        <div class="color-picker">
                            <div class="color-option" style="background-color: #5f2eea;" data-color="#5f2eea"></div>
                            <div class="color-option" style="background-color: #4e9f3d;" data-color="#4e9f3d"></div>
                            <div class="color-option" style="background-color: #fdc134;" data-color="#fdc134"></div>
                            <div class="color-option" style="background-color: #d62839;" data-color="#d62839"></div>
                            <div class="color-option" style="background-color: #1a1a2e;" data-color="#1a1a2e"></div>
                        </div>
                        <input type="hidden" id="edit-habit-color" value="#5f2eea">
                    </div>
                    <div class="mb-3 reminder-toggle">
                        <label class="form-label">Set Reminder</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="edit-habit-reminder">
                        </div>
                    </div>
                    <div class="mb-3 time-picker" id="edit-reminder-time-container" style="display: none;">
                        <select class="form-select" id="edit-reminder-hour">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                        <select class="form-select" id="edit-reminder-minute">
                            <option value="00">00</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="45">45</option>
                        </select>
                        <select class="form-select" id="edit-reminder-period">
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="edit-habit-goal" class="form-label">Goal (Optional)</label>
                        <input type="number" class="form-control" id="edit-habit-goal" placeholder="e.g. 30 days">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="edit-habit-form">Update Habit</button>
            </div>
        </div>
    </div>
</div>

<!-- Vendor JS Files -->
<script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script crossorigin="anonymous" integrity="sha512-kfs3Dt9u9YcOiIt4rNcPUzdyNNO9sVGQPiZsub7ywg6lRW5KuK1m145ImrFHe3LMWXHndoKo2YRXWy8rnOcSKg==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/5.0.0/imagesloaded.pkgd.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js"></script>

<!-- Main JS File -->
<script src="main.js"></script>

<script>
    // Initialize AOS animation
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });

    // Habit Tracker Application
    const HabitTracker = {
      habits: [],
      notes: [],
      currentDate: new Date(),
      currentMonth: new Date().getMonth(),
      currentYear: new Date().getFullYear(),
      stats: {
        currentStreak: 0,
        longestStreak: 0,
        completionRate: 0,
        daysCompleted: 0
      },
      weeklyChart: null,
      monthlyChart: null,

      // Initialize the application
      init: function() {
        this.loadData();
        this.setupEventListeners();
        this.updateGreeting();
        this.renderCalendar(this.currentMonth, this.currentYear);
        this.renderHabits();
        this.renderStats();
        this.initCharts();
        this.renderNotes();
      },

      // Load data from localStorage
      loadData: function() {
        const savedHabits = localStorage.getItem('habits');
        const savedNotes = localStorage.getItem('habitNotes');
        const savedStats = localStorage.getItem('habitStats');

        if (savedHabits) this.habits = JSON.parse(savedHabits);
        if (savedNotes) this.notes = JSON.parse(savedNotes);
        if (savedStats) this.stats = JSON.parse(savedStats);

        this.updateStats();
      },

      // Save data to localStorage
      saveData: function() {
        localStorage.setItem('habits', JSON.stringify(this.habits));
        localStorage.setItem('habitNotes', JSON.stringify(this.notes));
        localStorage.setItem('habitStats', JSON.stringify(this.stats));
      },

      // Update statistics based on current habits
      updateStats: function() {
        if (this.habits.length === 0) {
          this.stats = {
            currentStreak: 0,
            longestStreak: 0,
            completionRate: 0,
            daysCompleted: 0
          };
          return;
        }

        // Calculate current streak (days in a row with at least one habit completed)
        let currentStreak = 0;
        let today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let i = 0; i < 30; i++) {
          const checkDate = new Date(today);
          checkDate.setDate(today.getDate() - i);

          const hasCompletion = this.habits.some(habit =>
            habit.completions.some(c =>
              new Date(c.date).toDateString() === checkDate.toDateString()
            )
          );

          if (hasCompletion) {
            currentStreak++;
          } else {
            break;
          }
        }

        this.stats.currentStreak = currentStreak;

        // Calculate longest streak (simplified for demo)
        this.stats.longestStreak = Math.max(currentStreak, this.stats.longestStreak || 0);

        // Calculate completion rate (percentage of days this month with at least one habit completed)
        const daysInMonth = new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
        let completedDays = 0;

        for (let day = 1; day <= daysInMonth; day++) {
          const checkDate = new Date(this.currentYear, this.currentMonth, day);
          const hasCompletion = this.habits.some(habit =>
            habit.completions.some(c =>
              new Date(c.date).toDateString() === checkDate.toDateString()
            )
          );

          if (hasCompletion) completedDays++;
        }

        this.stats.daysCompleted = completedDays;
        this.stats.completionRate = Math.round((completedDays / daysInMonth) * 100);
      },

      // Set up event listeners
      setupEventListeners: function() {
        // Logout button
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
          e.preventDefault();
          localStorage.clear();
          window.location.href = 'index.html';
        });

        // Calendar navigation
        document.getElementById('prev-month').addEventListener('click', () => {
          this.currentMonth--;
          if (this.currentMonth < 0) {
            this.currentMonth = 11;
            this.currentYear--;
          }
          this.renderCalendar(this.currentMonth, this.currentYear);
        });

        document.getElementById('next-month').addEventListener('click', () => {
          this.currentMonth++;
          if (this.currentMonth > 11) {
            this.currentMonth = 0;
            this.currentYear++;
          }
          this.renderCalendar(this.currentMonth, this.currentYear);
        });

        // Add habit button
        document.getElementById('save-habit-btn').addEventListener('click', () => this.saveHabit());

        // Edit habit form will be handled dynamically when modal opens

        // Frequency selector
        document.querySelectorAll('.frequency-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('.frequency-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            document.getElementById('habit-frequency').value = e.target.dataset.frequency;
          });
        });

        // Color picker
        document.querySelectorAll('.color-option').forEach(option => {
          option.addEventListener('click', (e) => {
            document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
            e.target.classList.add('selected');
            document.getElementById('habit-color').value = e.target.dataset.color;
          });
        });

        // Reminder toggle
        document.getElementById('habit-reminder').addEventListener('change', (e) => {
          document.getElementById('reminder-time-container').style.display =
            e.target.checked ? 'flex' : 'none';
        });

        // Save note button
        document.getElementById('save-note-btn').addEventListener('click', () => this.saveNote());
      },

      // Update greeting based on time of day
      updateGreeting: function() {
        const hour = new Date().getHours();
        let greeting = 'Hello';

        if (hour < 12) greeting = 'Good morning';
        else if (hour < 18) greeting = 'Good afternoon';
        else greeting = 'Good evening';

        document.getElementById('greeting').textContent = `${greeting}, ${localStorage.getItem('username') || 'Habit Tracker'}!`;
      },

      // Render calendar
      renderCalendar: function(month, year) {
        const monthNames = ["January", "February", "March", "April", "May", "June",
                          "July", "August", "September", "October", "November", "December"];
        document.getElementById('current-month').textContent = `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        let calendarHTML = '';

        // Empty cells for days before the first day of the month
        for (let i = 0; i < firstDay; i++) {
          calendarHTML += '<div class="calendar-day"></div>';
        }

        // Days of the month
        for (let i = 1; i <= daysInMonth; i++) {
          const dayDate = new Date(year, month, i);
          const isToday = dayDate.toDateString() === new Date().toDateString();

          // Check if any habits were completed on this day
          const hasCompletion = this.habits.some(habit =>
            habit.completions.some(c =>
              new Date(c.date).toDateString() === dayDate.toDateString()
            )
          );

          // Check if any habits were missed on this day (before today)
          const isPastDay = dayDate < new Date() && !isToday;
          const hasMissed = isPastDay && this.habits.some(habit => {
            if (habit.frequency === 'daily') {
              return !habit.completions.some(c =>
                new Date(c.date).toDateString() === dayDate.toDateString()
              );
            }
            return false;
          });

          let dayClass = 'calendar-day';
          if (isToday) dayClass += ' today';
          if (hasCompletion) dayClass += ' completed';
          if (hasMissed) dayClass += ' missed';

          calendarHTML += `<div class="${dayClass}" data-date="${dayDate.toISOString()}">${i}`;

          // Add note indicator if there are notes for this day
          const hasNotes = this.notes.some(note =>
            new Date(note.date).toDateString() === dayDate.toDateString()
          );

          if (hasNotes) {
            calendarHTML += '<div class="calendar-day-notes"><i class="bi bi-pencil"></i></div>';
          }

          calendarHTML += '</div>';
        }

        document.getElementById('calendar-days').innerHTML = calendarHTML;

        // Add click event to calendar days
        document.querySelectorAll('.calendar-day').forEach(day => {
          day.addEventListener('click', () => {
            const date = new Date(day.dataset.date);
            this.showDayDetails(date);
          });
        });
      },

      // Show day details when a calendar day is clicked
      showDayDetails: function(date) {
        const formattedDate = date.toLocaleDateString('en-US', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });

        // Find habits completed on this day
        const completedHabits = this.habits.filter(habit =>
          habit.completions.some(c =>
            new Date(c.date).toDateString() === date.toDateString()
          )
        );

        // Find notes for this day
        const dayNotes = this.notes.filter(note =>
          new Date(note.date).toDateString() === date.toDateString()
        );

        // Create modal content
        let content = `
          <h5>${formattedDate}</h5>
          <div class="mt-3">
            <h6>Completed Habits</h6>
        `;

        if (completedHabits.length > 0) {
          content += '<ul class="list-group list-group-flush">';
          completedHabits.forEach(habit => {
            content += `<li class="list-group-item">${habit.name}</li>`;
          });
          content += '</ul>';
        } else {
          content += '<p>No habits completed this day.</p>';
        }

        content += `
          </div>
          <div class="mt-3">
            <h6>Notes</h6>
        `;

        if (dayNotes.length > 0) {
          dayNotes.forEach(note => {
            content += `
              <div class="note-item mb-2">
                <div class="note-content">${note.content}</div>
              </div>
            `;
          });
        } else {
          content += '<p>No notes for this day.</p>';
        }

        // Add form to add new note for this day
        content += `
          </div>
          <div class="mt-3">
            <h6>Add Note</h6>
            <textarea class="form-control mb-2" id="day-note-content" rows="3"></textarea>
            <button class="btn btn-primary" id="save-day-note-btn" data-date="${date.toISOString()}">Save Note</button>
          </div>
        `;

        // Create and show modal
        const modal = new bootstrap.Modal(document.createElement('div'));
        const modalEl = document.createElement('div');
        modalEl.className = 'modal fade';
        modalEl.innerHTML = `
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Day Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                ${content}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(modalEl);
        modal.show();

        // Handle note saving for this day
        modalEl.addEventListener('shown.bs.modal', () => {
          document.getElementById('save-day-note-btn').addEventListener('click', () => {
            const noteContent = document.getElementById('day-note-content').value.trim();
            if (noteContent) {
              this.addNote(new Date(document.getElementById('save-day-note-btn').dataset.date), noteContent);
              modal.hide();
              modalEl.remove();
              this.renderCalendar(this.currentMonth, this.currentYear);
            }
          });
        });

        modalEl.addEventListener('hidden.bs.modal', () => {
          modalEl.remove();
        });
      },

      // Render habits list
      renderHabits: function() {
        const habitsList = document.getElementById('habits-list');

        if (this.habits.length === 0) {
          habitsList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">
                <i class="bi bi-emoji-smile"></i>
              </div>
              <h5>No habits yet</h5>
              <p class="empty-state-text">Start by adding your first habit to track your progress</p>
              <button class="btn btn-primary" id="empty-add-habit-btn" data-bs-toggle="modal" data-bs-target="#addHabitModal">
                <i class="bi bi-plus-lg me-1"></i> Add Habit
              </button>
            </div>
          `;
          return;
        }

        let habitsHTML = '';

        this.habits.forEach((habit, index) => {
          // Calculate completion percentage for this month
          const daysInMonth = new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
          const completedDays = habit.completions.filter(c => {
            const date = new Date(c.date);
            return date.getMonth() === this.currentMonth && date.getFullYear() === this.currentYear;
          }).length;

          const completionRate = Math.round((completedDays / daysInMonth) * 100);

          // Calculate current streak for this habit
          let currentStreak = 0;
          let today = new Date();
          today.setHours(0, 0, 0, 0);

          for (let i = 0; i < 30; i++) {
            const checkDate = new Date(today);
            checkDate.setDate(today.getDate() - i);

            const hasCompletion = habit.completions.some(c =>
              new Date(c.date).toDateString() === checkDate.toDateString()
            );

            if (hasCompletion) {
              currentStreak++;
            } else {
              break;
            }
          }

          habitsHTML += `
            <div class="habit-item mb-4" data-habit-id="${habit.id}">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                  <h4 class="mb-0" style="color: ${habit.color}">${habit.name}</h4>
                  <span class="badge" style="background-color: ${habit.color}20; color: ${habit.color}">${habit.category}</span>
                </div>
                <div class="d-flex align-items-center">
                  <span class="streak-counter me-3">
                    <i class="bi bi-fire"></i> ${currentStreak} day streak
                  </span>
                  <div class="form-check form-switch">
                    <input class="form-check-input habit-toggle" type="checkbox" id="habit-toggle-${habit.id}"
                      ${habit.completions.some(c => new Date(c.date).toDateString() === new Date().toDateString()) ? 'checked' : ''}>
                  </div>
                </div>
              </div>
              <p class="text-muted">${habit.description || 'No description'}</p>
              <div class="progress mb-2" style="height: 10px;">
                <div class="progress-bar" role="progressbar"
                  style="width: ${completionRate}%; background-color: ${habit.color}"
                  aria-valuenow="${completionRate}" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <div class="d-flex justify-content-between">
                <small class="text-muted">${completionRate}% completion this month</small>
                <div>
                  <button class="btn btn-sm btn-outline-primary me-2 edit-habit-btn" data-habit-id="${habit.id}">
                    <i class="bi bi-pencil"></i> Edit
                  </button>
                  <button class="btn btn-sm btn-outline-danger delete-habit-btn" data-habit-id="${habit.id}">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </div>
              </div>
            </div>
          `;
        });

        habitsList.innerHTML = habitsHTML;
        document.getElementById('total-habits').textContent = this.habits.length;

        // Add event listeners to habit toggles
        document.querySelectorAll('.habit-toggle').forEach(toggle => {
          toggle.addEventListener('change', (e) => {
            const habitId = e.target.closest('.habit-item').dataset.habitId;
            const habit = this.habits.find(h => h.id === habitId);

            if (e.target.checked) {
              // Add completion for today
              habit.completions.push({
                date: new Date().toISOString()
              });
            } else {
              // Remove completion for today
              habit.completions = habit.completions.filter(c =>
                new Date(c.date).toDateString() !== new Date().toDateString()
              );
            }

            this.saveData();
            this.updateStats();
            this.renderStats();
            this.renderCalendar(this.currentMonth, this.currentYear);

            // Update charts
            if (this.weeklyChart) {
              this.weeklyChart.data.datasets[0].data = this.getWeeklyCompletionData();
              this.weeklyChart.update();
            }
            if (this.monthlyChart) {
              this.monthlyChart.data.datasets[0].data = this.getMonthlyConsistencyData();
              this.monthlyChart.update();
            }
          });
        });

        // Add event listeners to edit buttons
        document.querySelectorAll('.edit-habit-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const habitId = e.target.closest('button').dataset.habitId;
            this.showEditHabitModal(habitId);
          });
        });

        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-habit-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const habitId = e.target.closest('button').dataset.habitId;
            this.deleteHabit(habitId);
          });
        });
      },

      // Show edit habit modal
      showEditHabitModal: function(habitId) {
        const habit = this.habits.find(h => h.id === habitId);
        if (!habit) return;

        // Fill the edit form
        document.getElementById('edit-habit-id').value = habit.id;
        document.getElementById('edit-habit-name').value = habit.name;
        document.getElementById('edit-habit-category').value = habit.category;
        document.getElementById('edit-habit-description').value = habit.description || '';

        // Set frequency
        document.querySelectorAll('#edit-habit-form .frequency-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.frequency === habit.frequency) {
            btn.classList.add('active');
          }
        });
        document.getElementById('edit-habit-frequency').value = habit.frequency;

        // Set color
        document.querySelectorAll('#edit-habit-form .color-option').forEach(option => {
          option.classList.remove('selected');
          if (option.dataset.color === habit.color) {
            option.classList.add('selected');
          }
        });
        document.getElementById('edit-habit-color').value = habit.color;

        // Set reminder if exists
        if (habit.reminder) {
          document.getElementById('edit-habit-reminder').checked = true;
          document.getElementById('edit-reminder-time-container').style.display = 'flex';

          const [time, period] = habit.reminder.split(' ');
          const [hour, minute] = time.split(':');

          document.getElementById('edit-reminder-hour').value = hour;
          document.getElementById('edit-reminder-minute').value = minute;
          document.getElementById('edit-reminder-period').value = period;
        } else {
          document.getElementById('edit-habit-reminder').checked = false;
          document.getElementById('edit-reminder-time-container').style.display = 'none';
        }

        // Set goal if exists
        document.getElementById('edit-habit-goal').value = habit.goal || '';

        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('editHabitModal'));
        modal.show();
      },

      // Save new habit
      saveHabit: function() {
        const name = document.getElementById('habit-name').value.trim();
        const category = document.getElementById('habit-category').value;
        const description = document.getElementById('habit-description').value.trim();
        const frequency = document.getElementById('habit-frequency').value;
        const color = document.getElementById('habit-color').value;
        const hasReminder = document.getElementById('habit-reminder').checked;
        const goal = document.getElementById('habit-goal').value;

        if (!name) {
          this.showToast('Habit name is required', 'danger');
          return;
        }

        let reminder = null;
        if (hasReminder) {
          const hour = document.getElementById('reminder-hour').value;
          const minute = document.getElementById('reminder-minute').value;
          const period = document.getElementById('reminder-period').value;
          reminder = `${hour}:${minute} ${period}`;
        }

        const newHabit = {
          id: Date.now().toString(),
          name,
          category,
          description,
          frequency,
          color,
          reminder,
          goal: goal ? parseInt(goal) : null,
          completions: [],
          createdAt: new Date().toISOString()
        };

        this.habits.push(newHabit);
        this.saveData();
        this.updateStats();
        this.renderHabits();
        this.renderStats();

        // Update charts
        if (this.weeklyChart) {
          this.weeklyChart.data.datasets[0].data = this.getWeeklyCompletionData();
          this.weeklyChart.update();
        }
        if (this.monthlyChart) {
          this.monthlyChart.data.datasets[0].data = this.getMonthlyConsistencyData();
          this.monthlyChart.update();
        }

        // Reset form
        document.getElementById('habit-form').reset();
        document.querySelectorAll('.frequency-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('.frequency-btn[data-frequency="daily"]').classList.add('active');
        document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelector('.color-option[data-color="#5f2eea"]').classList.add('selected');
        document.getElementById('reminder-time-container').style.display = 'none';

        // Hide modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('addHabitModal'));
        modal.hide();

        this.showToast('Habit added successfully!', 'success');
      },

      // Update existing habit
      updateHabit: function() {
        const id = document.getElementById('edit-habit-id').value;
        const name = document.getElementById('edit-habit-name').value.trim();
        const category = document.getElementById('edit-habit-category').value;
        const description = document.getElementById('edit-habit-description').value.trim();
        const frequency = document.getElementById('edit-habit-frequency').value;
        const color = document.getElementById('edit-habit-color').value;
        const hasReminder = document.getElementById('edit-habit-reminder').checked;
        const goal = document.getElementById('edit-habit-goal').value;

        if (!name) {
          this.showToast('Habit name is required', 'danger');
          return;
        }

        const habitIndex = this.habits.findIndex(h => h.id === id);
        if (habitIndex === -1) return;

        let reminder = null;
        if (hasReminder) {
          const hour = document.getElementById('edit-reminder-hour').value;
          const minute = document.getElementById('edit-reminder-minute').value;
          const period = document.getElementById('edit-reminder-period').value;
          reminder = `${hour}:${minute} ${period}`;
        }

        this.habits[habitIndex] = {
          ...this.habits[habitIndex],
          name,
          category,
          description,
          frequency,
          color,
          reminder,
          goal: goal ? parseInt(goal) : null
        };

        this.saveData();
        this.renderHabits();

        // Update charts
        if (this.weeklyChart) {
          this.weeklyChart.data.datasets[0].data = this.getWeeklyCompletionData();
          this.weeklyChart.update();
        }
        if (this.monthlyChart) {
          this.monthlyChart.data.datasets[0].data = this.getMonthlyConsistencyData();
          this.monthlyChart.update();
        }

        // Hide modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('editHabitModal'));
        modal.hide();

        this.showToast('Habit updated successfully!', 'success');
      },

      // Delete habit
      deleteHabit: function(id) {
        if (confirm('Are you sure you want to delete this habit?')) {
          this.habits = this.habits.filter(h => h.id !== id);
          this.saveData();
          this.updateStats();
          this.renderHabits();
          this.renderStats();

          // Update charts
          if (this.weeklyChart) {
            this.weeklyChart.data.datasets[0].data = this.getWeeklyCompletionData();
            this.weeklyChart.update();
          }
          if (this.monthlyChart) {
            this.monthlyChart.data.datasets[0].data = this.getMonthlyConsistencyData();
            this.monthlyChart.update();
          }

          this.showToast('Habit deleted', 'info');
        }
      },

      // Render statistics
      renderStats: function() {
        document.getElementById('current-streak').textContent = this.stats.currentStreak;
        document.getElementById('longest-streak').textContent = this.stats.longestStreak;
        document.getElementById('completion-rate').textContent = `${this.stats.completionRate}%`;
        document.getElementById('days-completed').textContent = this.stats.daysCompleted;
      },

      // Initialize charts
      initCharts: function() {
        // Weekly Progress Chart
        const weeklyCtx = document.getElementById('weekly-chart').getContext('2d');
        this.weeklyChart = new Chart(weeklyCtx, {
          type: 'bar',
          data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
              label: 'Habits Completed',
              data: this.getWeeklyCompletionData(),
              backgroundColor: 'rgba(95, 46, 234, 0.7)',
              borderColor: 'rgba(95, 46, 234, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                max: Math.max(...this.getWeeklyCompletionData()) + 2 || 5
              }
            }
          }
        });

        // Monthly Consistency Chart
        const monthlyCtx = document.getElementById('monthly-chart').getContext('2d');
        this.monthlyChart = new Chart(monthlyCtx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
              label: 'Consistency %',
              data: this.getMonthlyConsistencyData(),
              fill: true,
              backgroundColor: 'rgba(95, 46, 234, 0.1)',
              borderColor: 'rgba(95, 46, 234, 1)',
              tension: 0.3,
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                max: 100
              }
            }
          }
        });
      },

      // Get weekly completion data for chart
      getWeeklyCompletionData: function() {
        const data = [0, 0, 0, 0, 0, 0, 0]; // For each day of week

        // Get the current week's dates
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0 (Sun) to 6 (Sat)
        const startDate = new Date(today);
        startDate.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1)); // Start at Monday

        for (let i = 0; i < 7; i++) {
          const checkDate = new Date(startDate);
          checkDate.setDate(startDate.getDate() + i);

          // Count completions for this day
          data[i] = this.habits.reduce((count, habit) => {
            return count + (habit.completions.some(c =>
              new Date(c.date).toDateString() === checkDate.toDateString()
            ) ? 1 : 0);
          }, 0);
        }

        return data;
      },

      // Get monthly consistency data for chart
      getMonthlyConsistencyData: function() {
        const data = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; // For each month

        // Get current year
        const currentYear = new Date().getFullYear();

        for (let month = 0; month < 12; month++) {
          const daysInMonth = new Date(currentYear, month + 1, 0).getDate();
          let completedDays = 0;

          for (let day = 1; day <= daysInMonth; day++) {
            const checkDate = new Date(currentYear, month, day);

            const hasCompletion = this.habits.some(habit =>
              habit.completions.some(c =>
                new Date(c.date).toDateString() === checkDate.toDateString()
              )
            );

            if (hasCompletion) completedDays++;
          }

          data[month] = Math.round((completedDays / daysInMonth) * 100);
        }

        return data;
      },

      // Render notes
      renderNotes: function() {
        const notesList = document.getElementById('habit-notes');

        if (this.notes.length === 0) {
          notesList.innerHTML = '<p class="text-muted">No notes yet. Add your first note below.</p>';
          return;
        }

        // Sort notes by date (newest first)
        const sortedNotes = [...this.notes].sort((a, b) =>
          new Date(b.date) - new Date(a.date)
        );

        let notesHTML = '';
        sortedNotes.forEach(note => {
          const date = new Date(note.date);
          const formattedDate = date.toLocaleDateString('en-US', {
            year: 'numeric', month: 'short', day: 'numeric'
          });

          notesHTML += `
            <div class="note-item">
              <div class="note-date">${formattedDate}</div>
              <p class="note-content">${note.content}</p>
              <button class="btn btn-sm btn-outline-danger delete-note-btn" data-note-id="${note.id}">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          `;
        });

        notesList.innerHTML = notesHTML;

        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-note-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const noteId = e.target.closest('button').dataset.noteId;
            this.deleteNote(noteId);
          });
        });
      },

      // Save new note
      saveNote: function() {
        const dateInput = document.getElementById('note-date').value;
        const content = document.getElementById('note-content').value.trim();

        if (!dateInput || !content) {
          this.showToast('Date and content are required', 'danger');
          return;
        }

        const newNote = {
          id: Date.now().toString(),
          date: new Date(dateInput).toISOString(),
          content,
          createdAt: new Date().toISOString()
        };

        this.notes.push(newNote);
        this.saveData();
        this.renderNotes();

        // Reset form
        document.getElementById('note-date').value = '';
        document.getElementById('note-content').value = '';

        this.showToast('Note added successfully!', 'success');
      },

      // Add note for specific day
      addNote: function(date, content) {
        if (!content.trim()) return;

        const newNote = {
          id: Date.now().toString(),
          date: date.toISOString(),
          content: content.trim(),
          createdAt: new Date().toISOString()
        };

        this.notes.push(newNote);
        this.saveData();
        this.renderNotes();
        this.showToast('Note added successfully!', 'success');
      },

      // Delete note
      deleteNote: function(id) {
        this.notes = this.notes.filter(n => n.id !== id);
        this.saveData();
        this.renderNotes();
        this.showToast('Note deleted', 'info');
      },

      // Show toast notification
      showToast: function(message, type) {
        const toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';

        const toastEl = document.createElement('div');
        toastEl.className = `toast show align-items-center text-white bg-${type} border-0`;
        toastEl.role = 'alert';
        toastEl.setAttribute('aria-live', 'assertive');
        toastEl.setAttribute('aria-atomic', 'true');

        toastEl.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        `;

        toastContainer.appendChild(toastEl);
        document.body.appendChild(toastContainer);

        setTimeout(() => {
          toastEl.classList.remove('show');
          setTimeout(() => {
            toastContainer.remove();
          }, 300);
        }, 3000);
      }
    };

    // Initialize the habit tracker when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Check authentication
      if (!localStorage.getItem('token')) {
        window.location.href = 'index.html';
        return;
      }

      // Load profile image
      const profileImage = document.getElementById('profileDropdown');
      const savedImage = localStorage.getItem('profilePhoto');
      if (savedImage) {
        profileImage.src = savedImage;
      }

      // Initialize habit tracker
      HabitTracker.init();

      // Set up edit habit form submission
      document.getElementById('edit-habit-form').addEventListener('submit', function(e) {
        e.preventDefault();
        HabitTracker.updateHabit();
      });

      // Set up edit habit reminder toggle
      document.getElementById('edit-habit-reminder').addEventListener('change', function(e) {
        document.getElementById('edit-reminder-time-container').style.display =
          e.target.checked ? 'flex' : 'none';
      });

      // Set up edit habit frequency buttons
      document.querySelectorAll('#edit-habit-form .frequency-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          document.querySelectorAll('#edit-habit-form .frequency-btn').forEach(b =>
            b.classList.remove('active')
          );
          e.target.classList.add('active');
          document.getElementById('edit-habit-frequency').value = e.target.dataset.frequency;
        });
      });

      // Set up edit habit color picker
      document.querySelectorAll('#edit-habit-form .color-option').forEach(option => {
        option.addEventListener('click', function(e) {
          document.querySelectorAll('#edit-habit-form .color-option').forEach(o =>
            o.classList.remove('selected')
          );
          e.target.classList.add('selected');
          document.getElementById('edit-habit-color').value = e.target.dataset.color;
        });
      });
    });
</script>

</body>
</html>